---
title: "RHRT: Finding Premature Ventricular Complexes"
author: "Valeria Blesius"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{RHRT: Finding Premature Ventricular Complexes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The RHRT package helps you find the **coupling (CPI)** and **compensatory interval (CMI)** as typical for a **premature ventricular beat**. This can be very useful for analysing interval data that is not annotated. The two intervals are found on the basis of the filter rules provided by Schmidt et al.^[Website about HRT by Schmidt et al.: http://www.h-r-t.com/hrt/en/calc.html].

## Filter Rules

There are two types of filter rules applied on the interval data:

1) First the filter rules for CPI and CMI are as following:

    * CPI must have a maximal length of 80 % 
    
    * CMI must have a minimal length of 120 %

    Both intervals are compared to the **reference interval (RFI)**. This interval is calculated as the mean of the last five preceding intervals before the coupling interval.
<br><br>

2) Second all "normal" intervals have to be inspected for artefacts. Therefore they have to pass the following rules:

    * The length has to be between 300 ms and 2000 ms
    
    * They must not differ more than 20 % from RFI
    
    * or more than 200 ms from the preceding interval

    The five preceding and fifteen following intervals of CPI and CMI are checked. If any of the intervals do not fit the rules, the complete set is neglected.


## HRT Object

**Intervals** &nbsp;&nbsp; The HRT Object consists of the two intervals surrounding the premature ventricular complex (CPI & CMI), the six preceding and sixteen following intervals. Although for filtering only the five and fifteen surrounding intervals are inspected, the neighbouring interval is needed for comparison, respectively.
<br><br>
An HRT object saves the following attributes of the found interval sequence:

**HRT Parameters** &nbsp;&nbsp; The parameters **turbulence onset (TO)** and **turbulence slope (TS)** can be calculated with `get_hrt_params` and are saved in the HRT object.


## HRTList Object

The HRTList object sums up all HRTs found in your given dataset. It consists of:

- **Positions** &nbsp;&nbsp; The indices of the extrasysoles (that is the premature ventricular complex / coupling interval) as found in the given vector.

- **HRTs** &nbsp;&nbsp; All found HRTs saved in HRT objects.

- **averaged HRT** &nbsp;&nbsp; The averaged HRT object which is calculated via estimating the mean of the intervals of all HRT objects.

An HRTList object ist created when `vectorToHRT` is called. all HRT parameters are calculated automatically in this process and can be called with the `getHRTParams`-methods.

## Workflow

At first use `vectorToHRT` to run through your interval data and find interval sequences that fit to the filter rules. Once you have the HRTList object you can get the HRT parameters TO and TS of your dataset and the positions where the HRT objects were found and plot it.

Example workflow:

```{r}
data("testdataVariant", package = "RHRT")

tdVariant <- testdataVariant
hrtlVar <- RHRT::vectorToHRT(tdVariant) # calculate the HRTList
hrtlVarParams <- RHRT::getHRTParamsMean(hrtlVar) # get the averaged HRT parameters
```

Other useful methods of HRTList:

- `getPositions` returns the indices of the coupling intervals of the found HRT objects in your vector
- `getHRTParamsAll` returns TO and TS for all HRT objects (except for the averaged HRT) in HRTList as matrix
## Plot

You can plot either a single HRT object or an HRTList. For the latter the averaged HRT object is plotted in dark tone while the other HRT objects are plotted behind in light tone. TO and TS are labeled for the HRT object or the averaged HRT object, respectively.

```{r,  fig.width=7, fig.height=4}
RHRT::plot(hrtlVar@HRTs[[1]], main = "One HRT object")
```

```{r,  fig.width=7, fig.height=4}
RHRT::plot(hrtlVar, main = "All HRT objects in an HRTList object")
```
In either case you can specify whether you want the plot to be cropped vertically so TO and TS can be better inspected. For it (???) CPI and CMI are not visible. 

```{r,  fig.width=7, fig.height=4}
RHRT::plot(hrtlVar, cropped = FALSE, main = "Not cropped")
```